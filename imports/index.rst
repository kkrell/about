Imports and exports
===================

.. note::
    
    Attention: the import procedure is about to change in the next version of
    DDI on Rails.

New import design (DDI on Rails 2)
----------------------------------

The new imports are closely tied to the data model. Many "additional
functionality" was removed, e.g., the link between logical variables and
question items is now in an independent import; and is no longer part of either
the logical variables import or the questions import.

Import formats
--------------

CSV formats
~~~~~~~~~~~

Markdown
    In most imports, there is a ``description`` field using Markdown. For more
    information about the Markdown markup language, see: `Daring Fireball
    <http://daringfireball.net/projects/markdown/>`__.

Conventions
    Some fields in the CSV exports are not part of the import. Those fields
    start with ``view_`` ``variables`` and ``datasets``.

    Columns with the ``internal_`` prefix are indended for internal use only
    and will not be imported (e.g. ``internal_comment``).

    Language codes, for all translation purposes: `ISO 639-1
    <http://en.wikipedia.org/wiki/List_of_ISO_639-1_codes>`__

XML formats
~~~~~~~~~~~

Endnote
    Publications in Endnote's XML export.

r2ddi
    DDI-Codebook-based XML, generated by r2ddi.

QeDML
    QeDML-XML from QLIB.

Other formats
~~~~~~~~~~~~~

Endnote keys
    Endnote keys are a special import of two columns (accession number and
    keywords) in addition to the normal XML import. Endnote exports everything
    but the keywords to XML what makes this import neccessary.

Conventions
-----------

-   Name identifiers: all names are set to lower case during import. This means
    that names must be unique despite their capitalization. Furthermore, only a
    limited set of characters is allowed in names: letters (a-z), numbers
    (0-9), dash (-), and underscore (_).

Import structure
----------------

Top level
~~~~~~~~~

::

    import/
    |-- system/       # -> system-wide imports
    |-- study-first/  # \
    |-- study-second/ #  }-> one folder per study
    |-- study-third/  # /

All levels
~~~~~~~~~~

::

    import/
    |-- system/
    |   |-- endnote.xml
    |   |-- endnote-keys.txt
    |   |-- ddiOnRails.png
    |   study-first/
    |   |-- studies.csv
    |   |-- variables.csv
    |   |-- ...all other csv files...
    |   |-- files/
    |   |   |-- ...all files for public folder...
    |   |   qedml/
    |   |   |-- ...questionnaires in QeDML-XML-format...
    |   |   r2ddi/
    |   |   |-- version/
    |   |   |   |-- ...dataset descriptions in DDI-C-XML...
    |-- study-second/
    |   |-- ...like study-first...

Import order
------------

#.  Studies

    -   study description

#.  Conceptual elements (study-independent):

    -   concepts
    -   analysis units
    -   periods
    -   conceptual datasets

#.  Instruments

    -   instruments (JSON combining questionnaires, questions, and answers)

#.  Data

    -   releases
    -   datasets
    -   variables
    -   r2ddi datasets
    -   question-variable links

#.  Publication

    -   publications in bibtex format

Formats
-------

.. toctree::
    :maxdepth: 1

    formats/markdown

CSV Imports
-----------

.. toctree::
    :maxdepth: 1

    csvs/studies_csv
    csvs/topics_csv
    csvs/concepts_csv
    csvs/periods_csv
    csvs/analysis_units_csv
    csvs/conceptual_datasets_csv
    csvs/logical_datasets_csv
    csvs/logical_variables_csv
    csvs/distributions_csv
    csvs/datasets_distributions_csv
    csvs/variables_csv
    csvs/variable_categories_csv
    csvs/generations_csv
    csvs/questionnaires_csv
    csvs/questions_csv
    csvs/answers_csv
    csvs/translations_csv
    csvs/script_generators_csv

